import{d as F,a as m,u as H,r as y,o as w,b as L,c as u,e as _,f as d,t as h,g as s,h as f,w as k,i as j,j as v,k as B,l as p}from"./index-CFa-6O-b.js";import{S as N}from"./Spinner-T2hdbTxp.js";const T=F("payment",{state:()=>({loading:!1,error:null,paymentData:null}),actions:{async initiatePayment(r){var l,n;this.loading=!0,this.error=null;try{const o=await m.post("/api/v1/payments/create-paypal-payment/",{course_id:r});return o.data.status==="enrolled"?{success:!0,freeCourse:!0}:(this.paymentData=o.data,{success:!0})}catch(o){return this.error=((n=(l=o.response)==null?void 0:l.data)==null?void 0:n.error)||"Payment initiation failed",{success:!1}}finally{this.loading=!1}},createPaypalForm(){var l;if(!((l=this.paymentData)!=null&&l.payment_url)){console.error("Invalid payment data");return}if(!this.paymentData)return;const r=document.createElement("form");r.method="POST",r.action=this.paymentData.payment_url,Object.entries(this.paymentData.payment_data).forEach(([n,o])=>{const e=document.createElement("input");e.type="hidden",e.name=n,e.value=o,r.appendChild(e)}),document.body.appendChild(r),r.submit()},async initiateChapaPayment(r){var l,n;this.loading=!0,this.error=null;try{const o=await m.post("/api/v1/payments/create-chapa-payment/",{course_id:r});return o.data.status==="enrolled"?{success:!0,freeCourse:!0}:(this.paymentData=o.data,{success:!0})}catch(o){return this.error=((n=(l=o.response)==null?void 0:l.data)==null?void 0:n.error)||"Chapa payment failed",{success:!1}}finally{this.loading=!1}},createChapaForm(){var l;if(!((l=this.paymentData)!=null&&l.payment_url)){console.error("Invalid Chapa payment data");return}const r=document.createElement("form");r.method="POST",r.action=this.paymentData.payment_url,Object.entries(this.paymentData.payment_data).forEach(([n,o])=>{const e=document.createElement("input");e.type="hidden",e.name=n,e.value=o,r.appendChild(e)}),document.body.appendChild(r),r.submit()}}}),M={class:"checkout-container max-w-2xl mx-auto p-6"},O={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center"},R={key:1,class:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg"},V={key:2,class:"text-center p-8 bg-green-50 rounded-xl"},z={class:"text-lg mb-4"},Z={key:3,class:"bg-white shadow-lg rounded-xl p-8"},$={class:"text-center mb-8"},A={class:"text-3xl font-bold text-gray-800 mb-2"},Y={class:"text-2xl font-semibold text-gray-600"},q={class:"space-y-6"},G=["disabled"],J=["disabled"],K={class:"mt-8 text-center text-sm text-gray-500"},Q={key:4,class:"text-center p-8 bg-red-50 rounded-xl"},X={__name:"Checkout",setup(r){const l=L();B();const n=T(),o=H(),e=y(null),i=y(!1),c=y(null),x=y(!1);w(async()=>{try{i.value=!0;const t=await m.get(`/api/v1/courses/${l.params.courseId}/`);e.value=t.data,e.value.price===0&&await g()}catch{c.value="Failed to load course details"}finally{i.value=!1}});const g=async()=>{try{(await n.initiatePayment(e.value.id)).freeCourse&&(x.value=!0,o.fetchEnrolledCourses())}catch(t){c.value=t.message||"Enrollment failed"}},P=async()=>{try{i.value=!0,(await n.initiatePayment(e.value.id)).success&&n.createPaypalForm()}catch(t){c.value=t.message||"Payment initialization failed"}finally{i.value=!1}},E=async()=>{try{if(i.value=!0,c.value=null,!(await m.get("/api/v1/users/me/")).data.email){c.value="Please update your email address first";return}(await n.initiateChapaPayment(e.value.id)).success&&n.createChapaForm()}catch(t){c.value=t.message||"Chapa payment failed to initialize"}finally{i.value=!1}};return w(async()=>{try{i.value=!0;const t=await m.get(`/api/v1/courses/${l.params.courseId}/`);e.value=t.data,e.value.price===0&&await g()}catch(t){c.value="Failed to load course details",console.error("Course load error:",t)}finally{i.value=!1}}),(t,a)=>{var C;const S=f("CheckCircleIcon"),b=f("router-link"),D=f("LockClosedIcon"),I=f("ExclamationTriangleIcon");return p(),u("div",M,[i.value?(p(),u("div",O,[d(N,{class:"w-16 h-16 text-white"})])):_("",!0),c.value?(p(),u("div",R,h(c.value),1)):_("",!0),x.value?(p(),u("div",V,[d(S,{class:"w-16 h-16 mx-auto text-green-600 mb-4"}),a[1]||(a[1]=s("h3",{class:"text-2xl font-bold mb-2"},"Enrollment Successful!",-1)),s("p",z,"You're now enrolled in "+h((C=e.value)==null?void 0:C.title),1),d(b,{to:"/my-courses",class:"inline-block px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"},{default:k(()=>a[0]||(a[0]=[v(" Access Course ")])),_:1})])):e.value?(p(),u("div",Z,[s("div",$,[s("h1",A,h(e.value.title),1),s("p",Y,"ETB "+h(e.value.price),1)]),s("div",q,[s("button",{onClick:P,disabled:t.processingPayment,class:"w-full flex items-center justify-center px-6 py-4 bg-blue-600 hover:bg-blue-700 rounded-xl shadow-md transition-all duration-300"},a[2]||(a[2]=[s("svg",{class:"w-8 h-8 mr-3",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M10.365 1.193c.756 3.477 3.462 5.11 6.175 5.11 1.51 0 3.063-.37 3.063-.37.603-.15.71.398.237.744-1.483 1.05-2.766 2.037-2.766 3.45 0 2.774 2.406 4.04 2.406 6.054 0 4.098-3.127 5.72-7.705 5.72h-8.46c-.576 0-1.076-.4-1.13-.97L2.084 3.784c-.053-.57.35-1.065.925-1.065h5.17c.576 0 1.075.4 1.13.97l.544 3.506c.053.57-.35 1.065-.925 1.065H6.76c-.576 0-1.075.4-1.13.97l-.11.696-.328 2.118c-.053.57.35 1.065.925 1.065h2.927c.576 0 1.075-.4 1.13-.97l.11-.696.327-2.118c.054-.57-.35-1.065-.925-1.065H8.81c-.576 0-1.075-.4-1.13-.97l-.11-.696-.328-2.118c-.053-.57.35-1.065.925-1.065h3.853z",fill:"currentColor"})],-1),s("span",{class:"text-xl font-semibold text-white"},"Pay with PayPal",-1)]),8,G),a[4]||(a[4]=j('<div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">OR</span></div></div>',1)),s("button",{onClick:E,disabled:t.processingPayment,class:"w-full flex items-center justify-center px-6 py-4 bg-green-600 hover:bg-green-700 rounded-xl shadow-md transition-all duration-300"},a[3]||(a[3]=[s("svg",{class:"w-8 h-8 mr-3",viewBox:"0 0 128 128",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[s("path",{d:"M64 128C99.3462 128 128 99.3462 128 64C128 28.6538 99.3462 0 64 0C28.6538 0 0 28.6538 0 64C0 99.3462 28.6538 128 64 128Z",fill:"#1C4D28"}),s("path",{d:"M47.8 80.6L57.9 47.8H76.7C81.5 47.8 84.6 50.1 85.3 54.5C85.7 57.1 85.1 59.4 83.7 61.3C82.3 63.2 80 64.6 76.8 65.4L85.2 80.6H72.6L66.5 65.4H56.3L50.2 80.6H47.8ZM61.4 60.3H69.5C73.3 60.3 75.3 59.1 75.6 56.7C75.8 55.3 75.2 54.2 73.8 53.4C72.4 52.6 70.4 52.2 67.8 52.2H63.8L61.4 60.3Z",fill:"white"})],-1),s("span",{class:"text-xl font-semibold text-white"},"Pay with Chapa",-1)]),8,J)]),s("div",K,[d(D,{class:"w-5 h-5 inline-block mr-2"}),a[5]||(a[5]=v(" Secure payment processing "))])])):(p(),u("div",Q,[d(I,{class:"w-16 h-16 mx-auto text-red-600 mb-4"}),a[7]||(a[7]=s("h2",{class:"text-2xl font-bold"},"Course Not Found",-1)),d(b,{to:"/courses",class:"inline-block mt-4 px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"},{default:k(()=>a[6]||(a[6]=[v(" Browse Courses ")])),_:1})]))])}}};export{X as default};
